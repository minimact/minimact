!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).MacticTracker={})}(this,function(t){"use strict";class e{constructor(t){if(this.contentHashes=new Map,this.initialized=!1,!t.apiKey)throw new Error("[Mactic] API key is required");if(!t.category)throw new Error("[Mactic] Category is required");if(!t.watchZones||0===t.watchZones.length)throw new Error("[Mactic] At least one watch zone is required");this.config={...t,apiEndpoint:t.apiEndpoint||"https://api.itsmactic.com/api/events",checkInterval:t.checkInterval||5e3,semanticThreshold:t.semanticThreshold||.1,enableMutationObserver:!1!==t.enableMutationObserver,enablePeriodicCheck:!1!==t.enablePeriodicCheck,enableDebugLogging:t.enableDebugLogging||!1,tags:t.tags||[],trustLevel:t.trustLevel||"unverified"},this.log("Tracker initialized",this.config)}init(){this.initialized?this.log("Tracker already initialized"):("loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.startMonitoring()):this.startMonitoring(),this.initialized=!0,this.log("Tracker started"))}destroy(){this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=void 0),this.checkIntervalId&&(clearInterval(this.checkIntervalId),this.checkIntervalId=void 0),this.contentHashes.clear(),this.initialized=!1,this.log("Tracker destroyed")}startMonitoring(){this.config.watchZones.forEach(t=>{const e=document.querySelector(t.selector);if(e){const i=this.hashContent(this.getElementContent(e));this.contentHashes.set(t.selector,i),this.log(`Initial hash for ${t.selector}:`,i)}else this.log(`Warning: Element not found: ${t.selector}`)}),this.config.enableMutationObserver&&(this.mutationObserver=new MutationObserver(()=>{this.checkForChanges()}),this.mutationObserver.observe(document.body,{childList:!0,subtree:!0,characterData:!0,attributes:!1}),this.log("MutationObserver started")),this.config.enablePeriodicCheck&&(this.checkIntervalId=window.setInterval(()=>{this.checkForChanges()},this.config.checkInterval),this.log(`Periodic check started (every ${this.config.checkInterval}ms)`)),this.checkForChanges()}async checkForChanges(){for(const t of this.config.watchZones){const e=document.querySelector(t.selector);if(!e)continue;const i=this.getElementContent(e),n=this.hashContent(i),o=this.contentHashes.get(t.selector);n!==o&&void 0!==o&&(this.log(`Change detected in ${t.selector}`),await this.notifyChange(t,e,i,o,n),this.contentHashes.set(t.selector,n))}}getElementContent(t){return(t.textContent||"").replace(/\s+/g," ").trim()}hashContent(t){let e=5381;for(let i=0;i<t.length;i++){e=(e<<5)+e+t.charCodeAt(i)}return e.toString(36)}async notifyChange(t,e,i,n,o){const s={url:window.location.href,selector:t.selector,importance:t.importance,content:i.substring(0,1e4),title:document.title,description:this.getMetaDescription(),timestamp:(new Date).toISOString(),category:this.config.category,tags:this.config.tags||[],ontologyPath:this.config.ontologyPath,trustLevel:this.config.trustLevel||"unverified",domain:window.location.hostname,language:document.documentElement.lang||"en",changeType:"content",oldHash:n,newHash:o};this.log("Notifying change:",s);try{const t=await fetch(this.config.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.config.apiKey},body:JSON.stringify(s)});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const e=await t.json();this.log("Change notification sent successfully:",e)}catch(t){console.error("[Mactic] Failed to notify change:",t)}}getMetaDescription(){const t=document.querySelector('meta[name="description"]');return t?.getAttribute("content")||""}log(t,...e){this.config.enableDebugLogging&&console.log(`[Mactic] ${t}`,...e)}}const i=t=>{const i=new e(t);return i.init(),i};"undefined"!=typeof window&&(window.MacticTracker={MacticTracker:e,init:i}),t.MacticTracker=e,t.init=i});
//# sourceMappingURL=tracker.min.js.map
